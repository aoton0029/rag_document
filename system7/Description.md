
aoton0029: AdvancedRAGã®ç‰¹å¾´ã¯ï¼Ÿ

GitHub Copilot: Advanced RAGã®ç‰¹å¾´ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚ä»Šå›å®Ÿè£…ã—ãŸã‚·ã‚¹ãƒ†ãƒ ã®ç‰¹å¾´ã‚’ä¸­å¿ƒã«è§£èª¬ã—ã¾ã™ã­ã€‚

## ğŸš€ Advanced RAGã®ä¸»è¦ç‰¹å¾´

### 1. **ãƒãƒ«ãƒãƒ¢ãƒ¼ãƒ€ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£**
- **Milvus (Vector Store)**: é«˜æ¬¡å…ƒãƒ™ã‚¯ãƒˆãƒ«ã®é«˜é€Ÿé¡ä¼¼æ€§æ¤œç´¢
- **Redis (Index Store)**: ã‚¤ãƒ³ãƒ¡ãƒ¢ãƒªã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ã‚ˆã‚‹é«˜é€Ÿã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ç®¡ç†
- **MongoDB (Document Store)**: æ§‹é€ åŒ–ã•ã‚ŒãŸãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç®¡ç†
- **Neo4j (Graph Store)**: ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£é–“ã®é–¢ä¿‚æ€§ã¨ãƒŠãƒ¬ãƒƒã‚¸ã‚°ãƒ©ãƒ•

### 2. **ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ¤œç´¢æ©Ÿèƒ½**
```python
# ãƒ™ã‚¯ãƒˆãƒ«æ¤œç´¢ + ã‚°ãƒ©ãƒ•æ¤œç´¢ã®çµ„ã¿åˆã‚ã›
hybrid_results = self._hybrid_search(query, top_k)
```
- ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯æ¤œç´¢ï¼ˆæ„å‘³çš„é¡ä¼¼æ€§ï¼‰
- ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢ï¼ˆå®Œå…¨ä¸€è‡´ãƒ»éƒ¨åˆ†ä¸€è‡´ï¼‰
- ã‚°ãƒ©ãƒ•ãƒ™ãƒ¼ã‚¹æ¤œç´¢ï¼ˆé–¢ä¿‚æ€§ã«ã‚ˆã‚‹æ‹¡å¼µï¼‰

### 3. **é«˜åº¦ãªãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå‡¦ç†**
- **ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ãƒãƒ£ãƒ³ã‚¯åˆ†å‰²**: æ„å‘³çš„å¢ƒç•Œã§ã®åˆ†å‰²
- **éšå±¤çš„æ§‹é€ èªè­˜**: ç« ãƒ»ç¯€ãƒ»æ®µè½ãƒ¬ãƒ™ãƒ«ã§ã®æ§‹é€ åŒ–
- **ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿æŠ½å‡º**: ãƒ•ã‚¡ã‚¤ãƒ«æƒ…å ±ã€ä½œæˆæ—¥æ™‚ã€ã‚¿ã‚°ä»˜ã‘

### 4. **å†ãƒ©ãƒ³ã‚­ãƒ³ã‚°æ©Ÿèƒ½**
```python
def _rerank_results(self, query: str, results: List) -> List:
    # ã‚¹ã‚³ã‚¢ãƒ™ãƒ¼ã‚¹ã®å†é †ä½ä»˜ã‘
    return sorted(results, key=lambda x: x.score, reverse=True)
```
- è¤‡æ•°ã®æ¤œç´¢çµæœã®çµ±åˆ
- ã‚¹ã‚³ã‚¢ãƒ™ãƒ¼ã‚¹ã®å„ªå…ˆé †ä½ä»˜ã‘
- é–¢é€£æ€§ã®å†è©•ä¾¡

### 5. **ãƒ­ãƒ¼ã‚«ãƒ«å®Œçµå‹AI**
- **Ollamaçµ±åˆ**: ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆç’°å¢ƒã§ã®LLMå®Ÿè¡Œ
- **ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å‹•ä½œ**: ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆä¸è¦
- **ãƒ‡ãƒ¼ã‚¿ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼**: å¤–éƒ¨é€ä¿¡ãªã—

### 6. **ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆæ‹¡å¼µæ©Ÿèƒ½**
```python
def _expand_context(self, retrieved_docs: List) -> str:
    # ã‚°ãƒ©ãƒ•ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰é–¢é€£æƒ…å ±ã‚’å–å¾—
    # é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®éšå±¤æ§‹é€ ã‚’è€ƒæ…®
```
- ã‚°ãƒ©ãƒ•ãƒ™ãƒ¼ã‚¹ã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆæ‹¡å¼µ
- è‡ªå‹•çš„ãªé–¢é€£æƒ…å ±ã®è£œå®Œ
- çŸ¥è­˜ã‚°ãƒ©ãƒ•ã‹ã‚‰ã®æ¨è«–

### 7. **ã‚½ãƒ¼ã‚¹å¼•ç”¨ã¨ãƒˆãƒ¬ãƒ¼ã‚µãƒ“ãƒªãƒ†ã‚£**
```python
class RAGResponse:
    answer: str
    sources: List[str]
    confidence_score: float
    reasoning_chain: List[str]
```
- å›ç­”ã®ã‚½ãƒ¼ã‚¹æ˜ç¤º
- ä¿¡é ¼åº¦ã‚¹ã‚³ã‚¢
- æ¨è«–éç¨‹ã®å¯è¦–åŒ–

### 8. **ã‚¹ã‚±ãƒ¼ãƒ©ãƒ–ãƒ«ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£**
- **åˆ†æ•£ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸**: å„DBã®ç‰¹æ€§ã‚’æ´»ç”¨
- **éåŒæœŸå‡¦ç†**: å¤§é‡ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ä¸¦åˆ—å‡¦ç†
- **ã‚­ãƒ£ãƒƒã‚·ãƒ¥æœ€é©åŒ–**: é »ç¹ãªã‚¯ã‚¨ãƒªã®é«˜é€ŸåŒ–

### 9. **Advanced Query Processing**
```python
def process_query(self, query: str) -> RAGResponse:
    # ã‚¯ã‚¨ãƒªåˆ†æãƒ»æ‹¡å¼µ
    expanded_query = self._expand_query(query)
    
    # ãƒãƒ«ãƒã‚¹ãƒˆãƒ©ãƒ†ã‚¸ãƒ¼æ¤œç´¢
    results = self._multi_strategy_search(expanded_query)
    
    # ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆçµ±åˆ
    context = self._integrate_context(results)
    
    # ç”Ÿæˆãƒ»æ¤œè¨¼
    return self._generate_and_verify(query, context)
```

### 10. **ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºæ©Ÿèƒ½**
- **è¨­å®šã®å¤–éƒ¨åŒ–**: ç’°å¢ƒåˆ¥è¨­å®šç®¡ç†
- **ãƒ­ã‚°ãƒ»ç›£è¦–**: è©³ç´°ãªå®Ÿè¡Œãƒ­ã‚°
- **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: å …ç‰¢ãªä¾‹å¤–å‡¦ç†
- **Dockerå¯¾å¿œ**: ã‚³ãƒ³ãƒ†ãƒŠåŒ–ã•ã‚ŒãŸãƒ‡ãƒ—ãƒ­ã‚¤

## ğŸ¯ å¾“æ¥ã®RAGã¨ã®é•ã„

| æ©Ÿèƒ½ | åŸºæœ¬RAG | Advanced RAG |
|------|---------|--------------|
| ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ | å˜ä¸€ãƒ™ã‚¯ãƒˆãƒ«DB | ãƒãƒ«ãƒDBçµ±åˆ |
| æ¤œç´¢æ–¹å¼ | ãƒ™ã‚¯ãƒˆãƒ«æ¤œç´¢ã®ã¿ | ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ¤œç´¢ |
| ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ | å›ºå®šãƒãƒ£ãƒ³ã‚¯ | å‹•çš„æ‹¡å¼µ |
| é–¢ä¿‚æ€§ | ãªã— | ã‚°ãƒ©ãƒ•ãƒ™ãƒ¼ã‚¹æ¨è«– |
| ç²¾åº¦ | åŸºæœ¬çš„ | å†ãƒ©ãƒ³ã‚­ãƒ³ã‚°æ©Ÿèƒ½ |

ã“ã®Advanced RAGã‚·ã‚¹ãƒ†ãƒ ã¯ã€ä¼æ¥­ãƒ¬ãƒ™ãƒ«ã®è¤‡é›‘ãªçŸ¥è­˜ç®¡ç†ã¨è³ªå•å¿œç­”ã«å¯¾å¿œã§ãã‚‹é«˜åº¦ãªæ©Ÿèƒ½ã‚’æä¾›ã—ã¾ã™ï¼


[Naive RAG ã¨ Advanced RAG ã®æ¯”è¼ƒ](https://www.myscale.com/blog/ja/naive-rag-vs-advanced-rag/)

[æ¤œç´¢æ‹¡å¼µâ½£æˆ(RAG) ã®ç²¾åº¦ã‚’å‘ä¸Šã•ã›ã‚‹Advanced RAGã«ã¤ã„ã¦å­¦ã‚“ã§ã¿ãŸ](https://zenn.dev/t_oishi/articles/1c39aadd259b80)

[A Cheat Sheet and Some Recipes For Building Advanced RAG](https://www.llamaindex.ai/blog/a-cheat-sheet-and-some-recipes-for-building-advanced-rag-803a9d94c41b)